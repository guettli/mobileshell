{{define "output-display"}}
{{if .IsBinary}}
    <div class="alert alert-info">
        <strong>Binary data detected in output</strong><br>
        This process output contains binary data and cannot be displayed as text.
        Use the <strong>Download Output</strong> button above to save the raw output.
    </div>
    {{if .Stderr}}
    <div class="output-section">
        <h6>Stderr:</h6>
        <div class="output-container stderr">{{.Stderr}}</div>
    </div>
    {{end}}
    {{if .Stdin}}
    <div class="output-section">
        <h6>Stdin:</h6>
        <div class="output-container stdin">{{.Stdin}}</div>
    </div>
    {{end}}
{{else}}
    {{if or .Stdout .Stderr .Stdin}}
        {{if .Stdout}}
        <div class="output-section">
            <h6>Stdout:</h6>
            {{if eq .ContentType "markdown"}}
            <div class="markdown-container">{{.StdoutHTML}}</div>
            {{else}}
            <div class="output-container">{{.Stdout}}</div>
            {{end}}
        </div>
        {{end}}
        {{if .Stderr}}
        <div class="output-section">
            <h6>Stderr:</h6>
            <div class="output-container stderr">{{.Stderr}}</div>
        </div>
        {{end}}
        {{if .Stdin}}
        <div class="output-section">
            <h6>Stdin:</h6>
            <div class="output-container stdin">{{.Stdin}}</div>
        </div>
        {{end}}
    {{else}}
        <em class="text-muted">No output yet</em>
    {{end}}
{{end}}
{{end}}

{{if eq .Type "combined"}}
    {{template "output-display" .}}
    {{if and .NeedsExpand (not .IsBinary)}}
    <div class="mt-2">
        <button class="btn btn-sm btn-outline-secondary"
                hx-get="{{$.BasePath}}/workspaces/{{$.WorkspaceID}}/processes/{{$.Process.ID}}/hx-output?type=combined&expand=true"
                hx-target="#output-{{$.Process.ID}}"
                hx-swap="innerHTML">
            Show full output...
        </button>
    </div>
    {{end}}
{{else}}
    <div class="output-container{{if eq .Type "stderr"}} stderr{{end}}">
    {{if .Content}}{{.Content}}{{else}}<em>No output yet</em>{{end}}
    </div>
{{end}}
